<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Recipe Generator</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        @keyframes fade-in {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .animate-fade-in {
            animation: fade-in 0.5s ease-in-out;
        }
        @keyframes fade-in-up {
            from { opacity: 0; transform: translate(-50%, 20px); }
            to { opacity: 1; transform: translate(-50%, 0); }
        }
        .animate-fade-in-up {
            animation: fade-in-up 0.3s ease-out;
        }
    </style>
</head>
<body class="bg-gray-900">
    <div id="root"></div>

    <script type="text/babel" data-presets="react">
const firebaseConfig = {
    apiKey: "AIzaSyAWUjwd1SigM4azYoUoC_i4w0g4_phOfJ0",
    authDomain: "smart-recipe-generator-f4715.firebaseapp.com",
    projectId: "smart-recipe-generator-f4715",
    storageBucket: "smart-recipe-generator-f4715.appspot.com",
    messagingSenderId: "410967078317",
    appId: "1:410967078317:web:07e99a5a1bfa3c86561d24",
    measurementId: "G-5L3NJXTL0L"
};

const appId = typeof __app_id !== 'undefined' ? __app_id : 'smart-recipe-generator-pro';

const GEMINI_API_KEY = "AIzaSyAT3Kv5OGCXZhH3aryRdbkFtugdriqIjnE"; // PASTE YOUR GEMINI API KEY HERE

const GEMINI_API_URL_TEXT = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${GEMINI_API_KEY}`;

const predefinedRecipes = [
    // Italian
    { recipeName: "Classic Margherita Pizza", baseServings: 4, imageUrl: "https://bellyfull.net/wp-content/uploads/2021/02/Margherita-Pizza-blog-2.jpg", description: "The timeless Italian pizza with fresh tomatoes, mozzarella, and basil.", cuisine: "Italian", difficulty: "Medium", cookingTime: "30", dietaryTags: ["Vegetarian"], ingredients: ["1 (12-inch) pre-baked pizza crust", "0.5 cup pizza sauce", "8 oz fresh mozzarella, sliced", "6 fresh basil leaves", "2 tbsp olive oil"], instructions: ["Preheat oven to 475°F (245°C) with a pizza stone inside.", "Place the dough on a lightly floured surface. Spread sauce evenly, leaving a 1-inch border.", "Arrange mozzarella slices, then bake for 10-12 minutes until crust is golden and cheese is bubbly.", "Garnish with fresh basil and a drizzle of olive oil before serving."], nutritionalInfo: { calories: "300 kcal", protein: "12g", carbs: "35g", fat: "15g" } },
    { recipeName: "Creamy Chicken Alfredo", baseServings: 4, imageUrl: "https://www.allrecipes.com/thmb/k892p_iIRp-56e-82s7y8P2i-lA=/1500x0/filters:no_upscale():max_bytes(150000):strip_icc()/276725-creamy-chicken-alfredo-DDMFS-4x3-324e931ad63645a293309a4897f7481b.jpg", description: "Creamy and decadent pasta dish with grilled chicken.", cuisine: "Italian", difficulty: "Medium", cookingTime: "25", dietaryTags: [], ingredients: ["8 oz fettuccine pasta", "1 lb boneless, skinless chicken breast", "2 tbsp olive oil", "2 cloves garlic, minced", "2 cups heavy cream", "1 cup grated Parmesan cheese"], instructions: ["Cook pasta according to package directions. Drain, reserving 1/2 cup of pasta water.", "While pasta cooks, season chicken with salt and pepper. Heat olive oil in a large skillet over medium-high heat. Cook chicken for 5-7 minutes per side, until cooked through. Remove and slice.", "In the same skillet, sauté garlic for 30 seconds. Add heavy cream and bring to a simmer. Stir in Parmesan cheese until smooth. Season with salt and pepper.", "Add cooked pasta and sliced chicken to the skillet. Toss to combine, adding reserved pasta water if the sauce is too thick. Serve immediately."], nutritionalInfo: { calories: "650 kcal", protein: "40g", carbs: "45g", fat: "35g" } },
    { recipeName: "Mushroom Risotto", baseServings: 4, imageUrl: "https://www.allrecipes.com/thmb/j-n-aP9Qg7J2h-95j-9a-uW-ZfI=/1500x0/filters:no_upscale():max_bytes(150000):strip_icc()/85389-gourmet-mushroom-risotto-video-1x1-141-a20398b1b22e434f8e71b2695a43e888.jpg", description: "Creamy Italian rice dish with savory mushrooms.", cuisine: "Italian", difficulty: "Medium", cookingTime: "45", dietaryTags: ["Vegetarian", "Gluten-Free"], ingredients: ["1 cup Arborio rice", "8 oz cremini mushrooms, sliced", "4 cups warm vegetable broth", "0.5 cup dry white wine", "1 small onion, finely chopped", "2 tbsp butter", "0.5 cup grated Parmesan cheese"], instructions: ["Keep vegetable broth warm in a saucepan.", "In a large pot, melt butter and sauté onion until soft. Add mushrooms and cook until browned.", "Add rice and toast for 1 minute. Pour in wine and cook until absorbed.", "Add broth one ladle at a time, stirring constantly until each is absorbed before adding the next. This takes about 20-25 minutes.", "Once rice is creamy and al dente, stir in Parmesan cheese. Season and serve."], nutritionalInfo: { calories: "420 kcal", protein: "15g", carbs: "60g", fat: "12g" } },
    { recipeName: "Hearty Beef Tacos", baseServings: 4, imageUrl: "https://www.onceuponachef.com/images/2017/03/Beef-Tacos-1200x1553.jpg", description: "Flavorful ground beef tacos with classic toppings.", cuisine: "Mexican", difficulty: "Easy", cookingTime: "20", dietaryTags: [], ingredients: ["1 lb ground beef", "1 packet taco seasoning", "0.75 cup water", "8 hard taco shells", "1 cup shredded lettuce", "1 tomato, diced", "1 cup shredded cheddar cheese"], instructions: ["In a skillet, brown ground beef over medium-high heat. Drain excess fat.", "Stir in taco seasoning and water. Bring to a simmer and cook for 5-7 minutes until thickened.", "Warm taco shells according to package directions.", "Assemble tacos with beef, lettuce, tomato, and cheese."], nutritionalInfo: { calories: "350 kcal", protein: "25g", carbs: "20g", fat: "18g" } },
    { recipeName: "Sizzling Chicken Fajitas", baseServings: 4, imageUrl: "https://www.eatwell101.com/wp-content/uploads/2018/03/Fajita-Chicken-Bake.jpg", description: "Sizzling chicken and peppers wrapped in warm tortillas.", cuisine: "Mexican", difficulty: "Easy", cookingTime: "30", dietaryTags: ["Dairy-Free"], ingredients: ["1 lb boneless, skinless chicken breast, sliced", "2 bell peppers, sliced", "1 large onion, sliced", "1 packet fajita seasoning", "2 tbsp vegetable oil", "8 flour tortillas"], instructions: ["In a bowl, toss chicken, peppers, and onion with fajita seasoning.", "Heat oil in a large skillet over medium-high heat. Add chicken and vegetable mixture.", "Cook, stirring frequently, for 8-10 minutes, until chicken is cooked through and vegetables are tender-crisp.", "Warm tortillas and serve immediately."], nutritionalInfo: { calories: "400 kcal", protein: "35g", carbs: "40g", fat: "10g" } },
    { recipeName: "Vegan Black Bean Soup", baseServings: 6, imageUrl: "https://nyssaskitchen.com/wp-content/uploads/2018/10/Black-Bean-Soup-19-scaled.jpg", description: "A rich and flavorful soup that is healthy and satisfying.", cuisine: "Mexican", difficulty: "Easy", cookingTime: "25", dietaryTags: ["Vegan", "Vegetarian", "Gluten-Free", "Dairy-Free"], ingredients: ["2 cans (15 oz) black beans, rinsed", "1 tbsp olive oil", "1 medium onion, chopped", "1 bell pepper, chopped", "2 cloves garlic, minced", "4 cups vegetable broth", "1 tsp cumin"], instructions: ["Heat olive oil in a pot. Sauté onion and bell pepper until soft.", "Add garlic and cumin, cook for 1 minute until fragrant.", "Add black beans and vegetable broth. Bring to a boil, then reduce heat and simmer for 15 minutes.", "For a creamier texture, blend about 2 cups of the soup and return it to the pot. Serve hot."], nutritionalInfo: { calories: "180 kcal", protein: "10g", carbs: "35g", fat: "1g" } },
    { recipeName: "Gluten-Free Chicken & Broccoli Stir-Fry", baseServings: 4, imageUrl: "https://www.inspiredtaste.net/wp-content/uploads/2022/02/Chicken-Broccoli-Stir-Fry-Recipe-1200.jpg", description: "A healthy and delicious stir-fry for a quick weeknight meal.", cuisine: "Asian", difficulty: "Easy", cookingTime: "20", dietaryTags: ["Gluten-Free", "Dairy-Free"], ingredients: ["1 lb boneless, skinless chicken breast, cubed", "4 cups broccoli florets", "0.25 cup tamari (gluten-free soy sauce)", "1 tbsp sesame oil", "2 cloves garlic, minced", "1 tbsp grated ginger"], instructions: ["In a small bowl, whisk together tamari, sesame oil, garlic, and ginger.", "Heat a large wok or skillet over high heat. Add a splash of neutral oil. Add chicken and cook until browned and cooked through. Remove from skillet.", "Add broccoli to the skillet with a splash of water, cover and steam for 3-4 minutes until tender-crisp.", "Return chicken to the skillet. Pour sauce over everything and toss to coat. Cook for 1-2 minutes until sauce has thickened slightly. Serve over rice."], nutritionalInfo: { calories: "350 kcal", protein: "38g", carbs: "12g", fat: "16g" } },
    { recipeName: "Quick Tofu Stir-Fry", baseServings: 2, imageUrl: "https://simpleveganblog.com/wp-content/uploads/2023/01/easy-tofu-stir-fry-square.jpg", description: "A quick, healthy, and colorful stir-fry with a savory sauce.", cuisine: "Asian", difficulty: "Easy", cookingTime: "15", dietaryTags: ["Vegan", "Vegetarian", "Dairy-Free"], ingredients: ["2 cups mixed vegetables (broccoli, carrots, snap peas)", "7 oz extra-firm tofu, pressed and cubed", "2 tbsp soy sauce", "1 tbsp sesame oil", "1 tsp fresh ginger, minced"], instructions: ["Whisk soy sauce, sesame oil, and ginger for the sauce.", "Heat oil in a wok over high heat. Add tofu and stir-fry until golden brown. Set aside.", "Add vegetables to the wok and stir-fry for 4-5 minutes until tender-crisp.", "Return tofu to the wok, pour sauce over, and toss to combine. Serve immediately."], nutritionalInfo: { calories: "300 kcal", protein: "15g", carbs: "25g", fat: "15g" } },
    { recipeName: "Spicy Thai Green Curry with Chicken", baseServings: 4, imageUrl: "https://www.kitchensanctuary.com/wp-content/uploads/2019/06/Thai-Green-Chicken-Curry-Square-FS.jpg", description: "Aromatic and fiery green curry with chicken and vegetables.", cuisine: "Thai", difficulty: "Medium", cookingTime: "35", dietaryTags: ["Dairy-Free"], ingredients: ["1 lb boneless, skinless chicken breast, cubed", "1 can (13.5 oz) full-fat coconut milk", "2 tbsp green curry paste", "1 cup mixed vegetables", "1 tbsp fish sauce", "1 tsp sugar"], instructions: ["Skim the thick cream from the top of the coconut milk can and heat it in a wok. Add curry paste and fry until fragrant.", "Add chicken and cook until no longer pink.", "Pour in the remaining coconut milk, fish sauce, and sugar. Simmer gently.", "Add vegetables and cook for 5-7 minutes until tender-crisp. Serve with jasmine rice."], nutritionalInfo: { calories: "450 kcal", protein: "30g", carbs: "15g", fat: "30g" } },
    { recipeName: "Pad Thai with Shrimp", baseServings: 3, imageUrl: "https://www.foodandwine.com/thmb/9-DRc_E7b89h3aC5w5f4O2P8N8g=/1500x0/filters:no_upscale():max_bytes(150000):strip_icc()/200804-r-shrimp-pad-thai-1-2000-745a9689a74945399d8a1f6a15779c16.jpg", description: "Classic Thai stir-fried noodles with shrimp and tofu.", cuisine: "Thai", difficulty: "Hard", cookingTime: "40", dietaryTags: ["Dairy-Free"], ingredients: ["8 oz flat rice noodles", "8 oz shrimp, peeled", "4 oz firm tofu, cubed", "2 large eggs, beaten", "1 cup bean sprouts", "0.25 cup chopped peanuts", "3 tbsp Pad Thai sauce"], instructions: ["Soak noodles in warm water until flexible; drain.", "Heat oil in a wok. Sauté shrimp and tofu until cooked; set aside. Scramble eggs in the wok; set aside.", "Add noodles and sauce to the wok, tossing until noodles absorb the sauce.", "Return shrimp, tofu, and eggs to the wok. Add bean sprouts and peanuts, tossing for 1 minute. Serve with lime wedges."], nutritionalInfo: { calories: "550 kcal", protein: "25g", carbs: "70g", fat: "18g" } },
    { recipeName: "Sheet Pan Lemon Herb Chicken", baseServings: 4, imageUrl: "https://www.ambitiouskitchen.com/wp-content/uploads/2024/01/Sheet-Pan-Lemon-Garlic-Chicken-Potatoes-6.jpg", description: "An easy and flavorful one-pan meal with chicken and broccoli.", cuisine: "American", difficulty: "Easy", cookingTime: "30", dietaryTags: ["Gluten-Free", "Dairy-Free"], ingredients: ["1.5 lbs boneless, skinless chicken breast", "5 cups broccoli florets", "1 lemon, sliced", "2 tbsp olive oil", "1 tsp dried oregano", "1 tsp dried thyme", "2 cloves garlic, minced"], instructions: ["Preheat oven to 400°F (200°C).", "On a large baking sheet, toss broccoli with 1 tbsp olive oil, salt, and pepper.", "In a bowl, toss chicken with remaining olive oil, oregano, thyme, garlic, salt, and pepper.", "Nestle the chicken among the broccoli on the baking sheet. Top with lemon slices.", "Bake for 20-25 minutes, or until chicken is cooked through and broccoli is tender and slightly charred.", "Serve immediately."], nutritionalInfo: { calories: "400 kcal", protein: "45g", carbs: "10g", fat: "20g" } },
    { recipeName: "Greek Salad with Grilled Chicken", baseServings: 2, imageUrl: "https://www.themediterraneandish.com/wp-content/uploads/2021/03/Greek-chicken-salad-recipe-6.jpg", description: "A fresh and healthy salad with classic Greek flavors.", cuisine: "Greek", difficulty: "Easy", cookingTime: "25", dietaryTags: ["Gluten-Free"], ingredients: ["1 lb boneless, skinless chicken breast", "1 head romaine lettuce", "1 cucumber", "1 large tomato", "0.25 cup Kalamata olives", "4 oz feta cheese", "2 tbsp olive oil", "1 tbsp red wine vinegar"], instructions: ["Season chicken with salt, pepper, and oregano. Grill over medium-high heat for 6-8 minutes per side, until cooked through. Let it rest, then slice.", "Wash and dry the romaine lettuce, then chop into bite-sized pieces.", "Dice the tomato into 1/2-inch cubes. Peel the cucumber, slice it lengthwise, remove seeds with a spoon, and chop into 1/2-inch half-moons.", "In a large bowl, combine the chopped lettuce, tomato, cucumber, and Kalamata olives.", "For the dressing, whisk together the olive oil and red wine vinegar. Season with salt and pepper.", "Add the sliced grilled chicken and crumbled feta cheese to the salad bowl. Drizzle with dressing and toss gently to combine. Serve immediately."], nutritionalInfo: { calories: "500 kcal", protein: "45g", carbs: "10g", fat: "30g" } },
    { recipeName: "Classic Beef Burger", baseServings: 4, imageUrl: "https://api.photon.aremedia.net.au/wp-content/uploads/sites/11/food/2014/11/28/AustralianWomensWeeklyBR116498/classic-beef-burger.jpg?fit=2048%2C1536", description: "A juicy, all-American beef burger on a toasted bun.", cuisine: "American", difficulty: "Easy", cookingTime: "15", dietaryTags: [], ingredients: ["1.5 lbs ground beef", "4 burger buns", "4 slices cheddar cheese", "Lettuce, tomato, and onion slices for topping"], instructions: ["Gently form ground beef into 4 patties, about 1-inch thick. Don't overwork the meat. Press a small indent in the center of each patty to prevent puffing up.", "Season both sides of the patties generously with salt and pepper.", "Grill or pan-sear over medium-high heat for 3-5 minutes per side for medium-rare. Adjust time for desired doneness.", "During the last minute of cooking, top each patty with a slice of cheese to melt.", "Toast the burger buns lightly on the grill or in the pan. Assemble burgers with your favorite toppings."], nutritionalInfo: { calories: "600 kcal", protein: "35g", carbs: "30g", fat: "38g" } },
    { recipeName: "Lemon Herb Baked Salmon", baseServings: 2, imageUrl: "https://www.mynaturalfamily.com/wp-content/uploads/baked-salmon-with-lemon.jpg", description: "Flaky and delicious salmon baked with lemon and herbs.", cuisine: "American", difficulty: "Easy", cookingTime: "20", dietaryTags: ["Gluten-Free", "Dairy-Free"], ingredients: ["2 (6 oz) salmon fillets", "1 lemon", "2 sprigs fresh dill", "2 tbsp olive oil", "Salt and pepper to taste"], instructions: ["Preheat your oven to 400°F (200°C).", "Place the salmon fillets on a baking sheet lined with parchment paper. Pat the salmon dry with a paper towel.", "Drizzle olive oil over each fillet. Season generously with salt and pepper.", "Thinly slice half the lemon and place the slices on top of the salmon. Juice the other half of the lemon over the fillets.", "Lay a sprig of dill on each piece of salmon.", "Bake for 12-15 minutes, or until the salmon is opaque and flakes easily with a fork."], nutritionalInfo: { calories: "380 kcal", protein: "40g", carbs: "2g", fat: "22g" } },
    { recipeName: "Japanese Chicken Katsu Curry", baseServings: 4, imageUrl: "https://japan.recipetineats.com/wp-content/uploads/2021/12/Katsu_Curry_7011b.jpg", description: "Crispy fried chicken cutlet with a savory Japanese curry sauce.", cuisine: "Japanese", difficulty: "Hard", cookingTime: "50", dietaryTags: [], ingredients: ["2 large chicken cutlets, pounded thin", "1 cup panko breadcrumbs", "1 large egg, beaten", "0.25 cup all-purpose flour", "2 Japanese curry blocks", "1 large potato, peeled and cubed", "1 large carrot, peeled and sliced"], instructions: ["Set up a breading station: one plate with flour, one bowl with the beaten egg, and one plate with panko.", "Season chicken with salt and pepper. Dredge in flour, dip in egg, then press firmly into panko to coat completely.", "Fill a large skillet with about 1 inch of neutral oil. Heat to 350°F (175°C). Fry chicken for 4-5 minutes per side until golden brown and cooked through. Drain on a wire rack.", "While chicken rests, boil potato and carrot in a saucepan until tender. Drain.", "In a separate pot, add water according to your curry block package directions. Bring to a simmer, add the curry blocks, and stir until completely dissolved. Add the cooked potato and carrot. Simmer for 5 minutes.", "Slice the katsu into strips. Serve over a bed of steamed rice, generously topped with the curry sauce."], nutritionalInfo: { calories: "700 kcal", protein: "40g", carbs: "80g", fat: "25g" } },
    { recipeName: "Classic French Onion Soup", baseServings: 4, imageUrl: "https://www.oliviascuisine.com/wp-content/uploads/2022/01/best-french-onion-soup-recipe.jpg", description: "A savory soup with caramelized onions and a cheesy crouton topping.", cuisine: "French", difficulty: "Hard", cookingTime: "75", dietaryTags: [], ingredients: ["4 large onions, thinly sliced", "4 cups beef broth", "0.5 cup dry white wine", "4 slices baguette", "1 cup Gruyère cheese, shredded"], instructions: ["In a large pot, melt butter over medium-low heat. Add onions and cook slowly for 45-60 minutes, stirring occasionally, until deeply caramelized and jammy.", "Deglaze the pot with white wine, scraping up any browned bits. Cook until the wine has almost evaporated.", "Add the beef broth, bring to a simmer, and cook for at least 20 minutes.", "Preheat your broiler. Ladle the soup into oven-safe bowls. Top each with a slice of baguette and a generous amount of Gruyère cheese.", "Place under the broiler for 2-3 minutes until the cheese is bubbly and golden brown."], nutritionalInfo: { calories: "400 kcal", protein: "18g", carbs: "30g", fat: "20g" } },
    { recipeName: "Indian Butter Chicken", baseServings: 4, imageUrl: "https://www.thecookierookie.com/wp-content/uploads/2022/08/Featured-Indian-butter-chicken-1.jpg", description: "Rich and creamy tomato-based curry with tender chicken pieces.", cuisine: "Indian", difficulty: "Medium", cookingTime: "45", dietaryTags: ["Gluten-Free"], ingredients: ["1.5 lbs boneless, skinless chicken thighs, cubed", "1 can (15 oz) tomato sauce", "1 cup heavy cream", "1 large onion, chopped", "2 tsp garam masala", "1 tsp turmeric", "1 tbsp ginger-garlic paste"], instructions: ["Marinate chicken in yogurt, lemon juice, ginger-garlic paste, and spices for at least 30 minutes.", "In a large pot, heat butter and sauté onion until golden.", "Add tomato sauce and spices. Cook for 10 minutes until the sauce thickens and deepens in color.", "Add the marinated chicken and cook for 15-20 minutes until cooked through.", "Stir in the heavy cream and simmer for 5 more minutes. Do not boil. Serve hot with naan or rice."], nutritionalInfo: { calories: "500 kcal", protein: "35g", carbs: "15g", fat: "35g" } },
    { recipeName: "Chana Masala", baseServings: 4, imageUrl: "https://cdn.loveandlemons.com/wp-content/uploads/2023/07/chana-masala-recipe.jpg", description: "A popular and flavorful chickpea curry.", cuisine: "Indian", difficulty: "Easy", cookingTime: "30", dietaryTags: ["Vegan", "Vegetarian", "Gluten-Free", "Dairy-Free"], ingredients: ["2 cans (15 oz) chickpeas, rinsed", "1 can (14.5 oz) diced tomatoes", "1 large onion, chopped", "2 cloves garlic, minced", "1 tsp garam masala", "1 tsp ground coriander", "0.5 tsp turmeric"], instructions: ["Heat oil in a pot over medium heat. Sauté the onion until soft and translucent.", "Add garlic and ginger, and cook for another minute until fragrant.", "Stir in the garam masala, coriander, and turmeric. Cook for 30 seconds to toast the spices.", "Add the diced tomatoes (with their juice) and the rinsed chickpeas. Stir to combine.", "Simmer for 20 minutes, lightly mashing some of the chickpeas against the side of the pot to thicken the sauce. Garnish with fresh cilantro before serving."], nutritionalInfo: { calories: "280 kcal", protein: "12g", carbs: "45g", fat: "5g" } },
    { recipeName: "Palak Paneer", baseServings: 4, imageUrl: "https://www.cookwithmanali.com/wp-content/uploads/2019/08/Palak-Paneer.jpg", description: "A classic vegetarian dish with spinach and Indian cheese.", cuisine: "Indian", difficulty: "Medium", cookingTime: "35", dietaryTags: ["Vegetarian", "Gluten-Free"], ingredients: ["10 oz fresh spinach", "8 oz paneer (panneer) cheese, cubed", "1 large onion, finely chopped", "1 can (14.5 oz) diced tomatoes", "0.5 cup heavy cream", "1 tsp cumin seeds", "1 tsp garam masala"], instructions: ["Blanch the spinach in boiling water for 2 minutes, then immediately transfer to an ice bath. Squeeze out excess water and blend to a smooth purée.", "Pan-fry the paneer cubes in a little oil until golden brown on all sides. Set aside.", "In the same pan, heat oil and add cumin seeds. Once they sizzle, add the onion and cook until golden.", "Add ginger-garlic paste, diced tomatoes, and spices. Cook until the oil begins to separate from the masala.", "Stir in the spinach purée and cook for 5 minutes. Add the paneer and heavy cream, and simmer for another 2-3 minutes. Serve hot."], nutritionalInfo: { calories: "350 kcal", protein: "18g", carbs: "15g", fat: "25g" } },
    { recipeName: "Matar Paneer", baseServings: 4, imageUrl: "https://static.toiimg.com/photo/53251884.cms", description: "A popular North Indian dish of paneer and peas in a tomato-based sauce.", cuisine: "Indian", difficulty: "Medium", cookingTime: "30", dietaryTags: ["Vegetarian", "Gluten-Free"], ingredients: ["8 oz paneer (panneer) cheese, cubed", "1 cup green peas", "1 large onion, pureed", "2 large tomatoes, pureed", "1 tbsp ginger-garlic paste", "1 tsp garam masala", "0.5 cup milk or cream"], instructions: ["Lightly fry the paneer cubes until golden and set aside.", "In a pan, heat oil and sauté the onion puree until it turns golden brown.", "Add the ginger-garlic paste and cook for a minute. Then add the tomato puree and cook until the oil starts to separate.", "Add turmeric, red chili powder, and coriander powder. Sauté for a minute.", "Add the green peas and 1 cup of water. Bring to a boil, then simmer for 5 minutes.", "Add the fried paneer cubes, garam masala, and milk/cream. Simmer for another 2-3 minutes. Garnish with cilantro."], nutritionalInfo: { calories: "320 kcal", protein: "15g", carbs: "18g", fat: "20g" } },
    { recipeName: "Paneer Butter Masala", baseServings: 4, imageUrl: "https://myfoodstory.com/wp-content/uploads/2021/07/restaurant-style-paneer-butter-masala-2-500x500.jpg", description: "A rich and creamy dish of paneer in a tomato, butter, and cashew sauce.", cuisine: "Indian", difficulty: "Medium", cookingTime: "35", dietaryTags: ["Vegetarian", "Gluten-Free"], ingredients: ["8 oz paneer (panneer) cheese, cubed", "2 tbsp butter", "1 large onion, chopped", "2 large tomatoes, chopped", "10 cashews, soaked in warm water", "1 tsp ginger-garlic paste", "1 tsp red chili powder", "1 tsp garam masala", "0.25 cup heavy cream"], instructions: ["Blend the soaked cashews into a fine paste. Separately, blend the tomatoes to a smooth puree.", "In a pan, melt butter. Sauté onions until golden.", "Add ginger-garlic paste and cook for a minute. Add the tomato puree and cook until it thickens.", "Add the cashew paste, red chili powder, and salt. Cook for 5 minutes.", "Add the paneer cubes and 1 cup of water. Simmer for 5-7 minutes.", "Stir in the heavy cream and garam masala. Cook for 1 more minute and serve hot."], nutritionalInfo: { calories: "450 kcal", protein: "15g", carbs: "15g", fat: "38g" } },

    // Healthy & Vegetarian
    { recipeName: "Quinoa Salad with Roasted Vegetables", baseServings: 4, imageUrl: "https://dudethatcookz.com/wp-content/uploads/2020/11/quinoa_roasted_veggies_5-scaled.jpg", description: "A nutritious and filling salad perfect for a light meal.", cuisine: "Healthy", difficulty: "Easy", cookingTime: "40", dietaryTags: ["Vegan", "Vegetarian", "Gluten-Free", "Dairy-Free"], ingredients: ["1 cup quinoa, rinsed", "2 cups mixed vegetables for roasting (e.g., bell peppers, zucchini, broccoli)", "0.25 cup olive oil", "2 tbsp lemon juice", "1 clove garlic, minced"], instructions: ["Preheat oven to 400°F (200°C). Toss vegetables with half the olive oil, salt, and pepper. Roast for 20-25 minutes until tender and caramelized.", "Cook quinoa according to package directions (usually simmering in 2 cups of water for 15 minutes).", "In a small bowl, whisk together the remaining olive oil, lemon juice, and garlic for the dressing.", "In a large bowl, combine the cooked quinoa, roasted vegetables, and dressing. Toss to combine. Can be served warm or cold."], nutritionalInfo: { calories: "350 kcal", protein: "12g", carbs: "40g", fat: "18g" } },
    { recipeName: "Vegan Lentil Shepherd's Pie", baseServings: 6, imageUrl: "https://www.shockinglydelicious.com/wp-content/uploads/2019/11/Vegan-Lentil-Mushroom-Shepherds-Pie-recipe-on-ShockinglyDelicious.com_.jpg", description: "A hearty and comforting plant-based version of the classic.", cuisine: "British", difficulty: "Medium", cookingTime: "60", dietaryTags: ["Vegan", "Vegetarian", "Gluten-Free", "Dairy-Free"], ingredients: ["2 cups brown or green lentils, cooked", "1 large onion, chopped", "2 carrots, diced", "4 cups mashed potatoes (made with plant milk & butter)", "1 cup vegetable broth", "1 tbsp tomato paste"], instructions: ["Preheat oven to 400°F (200°C).", "In a skillet, sauté onion and carrots until soft. Stir in tomato paste, then add cooked lentils and vegetable broth. Simmer for 10 minutes to create the filling.", "Transfer the lentil filling to a baking dish.", "Carefully spread the prepared mashed potatoes over the top of the filling.", "Bake for 20-25 minutes, or until the filling is bubbly and the potato topping is lightly golden."], nutritionalInfo: { calories: "450 kcal", protein: "20g", carbs: "65g", fat: "12g" } },
    { recipeName: "Black Bean Burgers", baseServings: 4, imageUrl: "https://dishingouthealth.com/wp-content/uploads/2023/02/Blackbeanburgers_Square2-2.jpg", description: "Hearty and delicious vegetarian burgers packed with flavor.", cuisine: "Vegetarian", difficulty: "Medium", cookingTime: "30", dietaryTags: ["Vegetarian"], ingredients: ["1 can (15 oz) black beans, rinsed and mashed", "0.5 cup breadcrumbs", "1 large egg, lightly beaten", "0.5 medium onion, finely chopped", "1 tsp cumin", "4 burger buns"], instructions: ["In a medium bowl, combine the mashed black beans, breadcrumbs, egg, onion, and cumin. Mix until well combined, but leave some texture in the beans.", "Divide the mixture into four equal portions and shape them into patties.", "Heat a little oil in a skillet over medium heat. Cook the patties for 4-5 minutes per side, until firm and nicely browned.", "Serve on burger buns with your favorite toppings."], nutritionalInfo: { calories: "320 kcal", protein: "15g", carbs: "50g", fat: "8g" } },
    { recipeName: "Hearty Lentil Soup", baseServings: 6, imageUrl: "https://simple-veganista.com/wp-content/uploads/2019/10/vegan-lentil-soup-recipe-5.jpg", description: "A warm and nourishing soup made with lentils and vegetables.", cuisine: "Healthy", difficulty: "Easy", cookingTime: "45", dietaryTags: ["Vegan", "Vegetarian", "Gluten-Free", "Dairy-Free"], ingredients: ["1 cup brown lentils, rinsed", "1 large onion, chopped", "2 carrots, chopped", "2 celery stalks, chopped", "6 cups vegetable broth", "1 can (14.5 oz) diced tomatoes", "1 tsp dried thyme"], instructions: ["Heat a little olive oil in a large pot. Sauté the onion, carrots, and celery until softened, about 7-10 minutes.", "Add the rinsed lentils, vegetable broth, diced tomatoes, and thyme.", "Bring the soup to a boil, then reduce the heat, cover, and let it simmer for 30-40 minutes, or until the lentils are tender.", "Season with salt and pepper to taste before serving."], nutritionalInfo: { calories: "220 kcal", protein: "12g", carbs: "40g", fat: "1g" } },
    { recipeName: "Vegan Tofu Scramble", baseServings: 2, imageUrl: "https://plantbasedonabudget.com/wp-content/uploads/2023/01/87-Tofu-Scramble-Plant-Based-on-a-Budget-8.jpg", description: "A delicious plant-based alternative to scrambled eggs.", cuisine: "Vegetarian", difficulty: "Easy", cookingTime: "15", dietaryTags: ["Vegan", "Vegetarian", "Gluten-Free", "Dairy-Free"], ingredients: ["1 block (14 oz) firm tofu, pressed", "1 tbsp nutritional yeast", "0.5 tsp turmeric", "0.25 tsp black salt (kala namak)", "1 tbsp olive oil", "0.25 cup chopped onion"], instructions: ["Crumble the pressed tofu into a bowl with your hands.", "Add nutritional yeast, turmeric, and black salt. Gently toss to combine.", "Heat olive oil in a skillet over medium heat. Sauté onion until soft.", "Add the tofu mixture and cook, stirring occasionally, for 5-7 minutes until heated through. Serve hot."], nutritionalInfo: { calories: "250 kcal", protein: "20g", carbs: "8g", fat: "15g" } },
    { recipeName: "Beef and Broccoli Stir-Fry", baseServings: 4, imageUrl: "https://natashaskitchen.com/wp-content/uploads/2019/08/Beef-and-Broccoli-2.jpg", description: "A classic Asian-American stir-fry, made gluten-free.", cuisine: "Asian", difficulty: "Medium", cookingTime: "25", dietaryTags: ["Gluten-Free", "Dairy-Free"], ingredients: ["1 lb flank steak, thinly sliced", "4 cups broccoli florets", "0.5 cup beef broth", "0.25 cup tamari", "1 tbsp cornstarch", "1 tbsp sesame oil"], instructions: ["Slice steak against the grain. In a bowl, toss with 1 tbsp tamari and cornstarch.", "In a small bowl, whisk together remaining tamari, beef broth, and sesame oil for the sauce.", "Heat oil in a wok. Sear beef in batches until browned; set aside.", "Add broccoli and a splash of water to the wok, cover and steam for 3-4 minutes.", "Return beef to the wok. Pour sauce over and cook until it thickens. Serve with rice."], nutritionalInfo: { calories: "450 kcal", protein: "40g", carbs: "15g", fat: "25g" } },

    // Seafood
    { recipeName: "Shrimp Scampi with Linguine", baseServings: 2, imageUrl: "https://www.southernliving.com/thmb/v2POrtDcB_1HiCd4NY3PIShf6ck=/1500x0/filters:no_upscale():max_bytes(150000):strip_icc()/pasta0312_01_0-2000-85cfa61bad82423792ad5334b2675419.jpg", description: "A simple yet elegant pasta dish with shrimp in a garlic butter sauce.", cuisine: "Italian", difficulty: "Easy", cookingTime: "20", dietaryTags: [], ingredients: ["8 oz linguine", "1 lb large shrimp, peeled and deveined", "4 cloves garlic, minced", "0.5 cup dry white wine", "0.25 cup butter", "2 tbsp fresh parsley, chopped"], instructions: ["Cook linguine according to package directions. Drain, reserving some pasta water.", "In a large skillet, melt butter over medium heat. Add garlic and cook for 30 seconds until fragrant.", "Add the shrimp and cook for 2-3 minutes until they turn pink. Do not overcook.", "Pour in the white wine and bring to a simmer. Let it reduce by half.", "Add the cooked linguine to the skillet and toss to combine. Add a splash of pasta water to create a silky sauce. Stir in the parsley before serving."], nutritionalInfo: { calories: "550 kcal", protein: "30g", carbs: "60g", fat: "18g" } },
    { recipeName: "Pan-Seared Scallops", baseServings: 2, imageUrl: "https://www.inspiredtaste.net/wp-content/uploads/2018/08/Pan-Seared-Scallops-Recipe-1200.jpg", description: "Perfectly seared scallops with a simple lemon butter sauce.", cuisine: "American", difficulty: "Medium", cookingTime: "10", dietaryTags: ["Gluten-Free"], ingredients: ["1 lb large sea scallops", "2 tbsp butter", "1 tbsp olive oil", "1 lemon", "Salt and pepper"], instructions: ["Gently rinse the scallops and pat them completely dry with paper towels. This is crucial for a good sear. Season with salt and pepper.", "Heat butter and olive oil in a skillet over high heat until the butter is foaming.", "Carefully place the scallops in the hot pan, ensuring they are not touching. Sear for 1.5-2 minutes per side without moving them, until a deep golden-brown crust forms.", "Remove from heat and squeeze fresh lemon juice over the scallops just before serving."], nutritionalInfo: { calories: "320 kcal", protein: "35g", carbs: "3g", fat: "18g" } },
    { recipeName: "Fish Tacos with Cabbage Slaw", baseServings: 4, imageUrl: "https://cdn.apartmenttherapy.info/image/upload/f_jpg,q_auto:eco,c_fill,g_auto,w_1500,ar_4:3/tk%2Fphoto%2F2025%2F04-2025%2F2025-04-fish-tacos%2Ffish-tacos-574", description: "Light and fresh fish tacos with a tangy slaw.", cuisine: "Mexican", difficulty: "Easy", cookingTime: "25", dietaryTags: [], ingredients: ["1 lb white fish fillets (like cod or tilapia)", "1 tsp chili powder", "8 small corn tortillas", "2 cups shredded cabbage", "0.25 cup cilantro, chopped", "0.25 cup mayonnaise", "1 lime, juiced"], instructions: ["For the slaw, combine shredded cabbage, cilantro, mayonnaise, and lime juice in a bowl. Season with salt and pepper and set aside.", "Season the fish fillets with chili powder, salt, and pepper.", "Heat a little oil in a skillet over medium-high heat. Cook the fish for 3-4 minutes per side, until opaque and flaky.", "Warm the corn tortillas.", "Break the cooked fish into chunks and assemble the tacos with the fish and cabbage slaw."], nutritionalInfo: { calories: "380 kcal", protein: "25g", carbs: "30g", fat: "18g" } },

    // Desserts
    { recipeName: "Chocolate Lava Cakes", baseServings: 4, imageUrl: "https://assets.winni.in/product/primary/2022/4/58465.jpeg?dpr=1&w=500", description: "Decadent individual chocolate cakes with a molten center.", cuisine: "Dessert", difficulty: "Medium", cookingTime: "25", dietaryTags: ["Vegetarian"], ingredients: ["4 oz dark chocolate, chopped", "0.5 cup unsalted butter", "2 large eggs", "2 large egg yolks", "0.25 cup sugar", "2 tbsp all-purpose flour"], instructions: ["Preheat oven to 425°F (220°C). Grease and flour four small ramekins.", "In a microwave-safe bowl, melt the chocolate and butter together in 30-second intervals, stirring in between.", "In a separate bowl, whisk the eggs, egg yolks, and sugar together until pale and fluffy.", "Gently fold the melted chocolate mixture into the egg mixture, then fold in the flour until just combined.", "Divide the batter evenly among the prepared ramekins.", "Bake for 12-14 minutes. The edges should be firm, but the center will be soft. Let cool for a minute, then carefully invert onto plates and serve immediately."], nutritionalInfo: { calories: "450 kcal", protein: "8g", carbs: "35g", fat: "30g" } },
    { recipeName: "Classic Apple Crumble", baseServings: 6, imageUrl: "https://www.newworld.co.nz/-/media/Project/Sitecore/Brands/Brand-New-World/Recipes-2023/classic_apple_crumble_02.jpg?h=516&w=600&hash=5FE17BF747CB7D2137FADACC0600CC8C", description: "A classic warm dessert with a crunchy oat topping.", cuisine: "Dessert", difficulty: "Easy", cookingTime: "45", dietaryTags: ["Vegetarian"], ingredients: ["4 large apples, peeled and sliced", "1 cup all-purpose flour", "0.5 cup brown sugar", "0.5 cup rolled oats", "0.5 cup cold butter, cubed", "1 tsp cinnamon"], instructions: ["Preheat oven to 375°F (190°C).", "In a bowl, toss the sliced apples with half the cinnamon and a tablespoon of sugar. Arrange them in a baking dish.", "For the topping, combine the flour, brown sugar, oats, and remaining cinnamon. Use your fingertips or a pastry cutter to cut in the cold butter until the mixture resembles coarse crumbs.", "Sprinkle the crumble topping evenly over the apples.", "Bake for 30-35 minutes, or until the topping is golden brown and the fruit is bubbly."], nutritionalInfo: { calories: "380 kcal", protein: "4g", carbs: "55g", fat: "16g" } },
    { recipeName: "Avocado Chocolate Mousse", baseServings: 4, imageUrl: "https://loveonetoday.com/wp-content/uploads/Love-One-Today-Avocado-Dark-Chocolate-Mousse-featured.jpg", description: "A surprisingly healthy and creamy vegan dessert.", cuisine: "Dessert", difficulty: "Easy", cookingTime: "10", dietaryTags: ["Vegan", "Vegetarian", "Gluten-Free", "Dairy-Free"], ingredients: ["2 ripe avocados", "0.5 cup cocoa powder", "0.5 cup maple syrup", "0.25 cup plant-based milk", "1 tsp vanilla extract"], instructions: ["Slice the avocados in half, remove the pits, and scoop the flesh into a high-speed blender or food processor.", "Add the cocoa powder, maple syrup, plant-based milk, and vanilla extract.", "Blend on high speed until the mixture is completely smooth and creamy, scraping down the sides as needed.", "Divide the mousse into serving dishes and chill for at least 30 minutes to an hour to allow it to firm up before serving."], nutritionalInfo: { calories: "280 kcal", protein: "4g", carbs: "30g", fat: "18g" } },
    
    // Additional Recipes for Filter Diversity
    { recipeName: "Spinach and Feta Stuffed Chicken", baseServings: 4, imageUrl: "https://www.eatingwell.com/thmb/lAEwtQROBY8pEVjuip5Q-eSfQ3U=/1500x0/filters:no_upscale():max_bytes(150000):strip_icc()/1501p130-spinach-feta-stuffed-chicken-breasts-8030825-66b09a00be4340c6a6af32fda656319c.jpg", description: "Tender chicken breast stuffed with a flavorful spinach and feta mix.", cuisine: "Mediterranean", difficulty: "Medium", cookingTime: "40", dietaryTags: ["Gluten-Free"], ingredients: ["4 boneless, skinless chicken breasts", "4 oz feta cheese, crumbled", "2 cups fresh spinach", "1 clove garlic, minced", "1 tbsp olive oil"], instructions: ["Preheat oven to 375°F (190°C).", "Wilt spinach in a pan with a little water, then squeeze out all excess moisture. Mix with feta cheese and minced garlic.", "Cut a pocket into the side of each chicken breast. Stuff the spinach and feta mixture inside, securing with toothpicks if necessary.", "Heat olive oil in an oven-safe skillet over medium-high heat. Sear the chicken for 2-3 minutes per side until golden.", "Transfer the skillet to the preheated oven and bake for 20-25 minutes, or until the chicken is cooked through."], nutritionalInfo: { calories: "450 kcal", protein: "50g", carbs: "5g", fat: "25g" } },
    { recipeName: "Pulled Pork Sandwiches", baseServings: 8, imageUrl: "https://www.melskitchencafe.com/wp-content/uploads/2010/08/bbq-pork-sandwich1.jpg", description: "Slow-cooked, tender pulled pork in a tangy BBQ sauce.", cuisine: "American", difficulty: "Medium", cookingTime: "240", dietaryTags: [], ingredients: ["4 lb pork shoulder (Boston butt)", "1 cup of your favorite BBQ sauce", "1 large onion, chopped", "8 sandwich buns"], instructions: ["Place the chopped onion at the bottom of a slow cooker. Place the pork shoulder on top.", "Cook on low for 6-8 hours or on high for 4-5 hours, until the pork is fall-apart tender.", "Carefully remove the pork from the slow cooker and place it in a large bowl. Use two forks to shred the meat.", "Drain the liquid from the slow cooker. Return the shredded pork to the slow cooker and stir in the BBQ sauce until the pork is evenly coated. Heat through and serve on buns."], nutritionalInfo: { calories: "550 kcal", protein: "45g", carbs: "40g", fat: "22g" } },
    { recipeName: "Coq au Vin", baseServings: 6, imageUrl: "https://www.theendlessmeal.com/wp-content/uploads/2019/03/Coq-au-Vin-Recipe-3.jpg", description: "A traditional French stew of chicken braised with wine.", cuisine: "French", difficulty: "Hard", cookingTime: "120", dietaryTags: [], ingredients: ["1 whole chicken (3-4 lbs), cut into pieces", "1 bottle of dry red wine (like Burgundy)", "8 oz mushrooms, quartered", "1 large onion, chopped", "4 oz bacon lardons", "2 tbsp brandy (optional)"], instructions: ["Marinate the chicken pieces in the red wine overnight in the refrigerator.", "Remove chicken from marinade (reserve the wine). Pat chicken dry. In a Dutch oven, cook bacon lardons until crisp. Remove bacon and brown the chicken pieces in the bacon fat. Set chicken aside.", "Sauté the onion and mushrooms in the same pot until softened.", "Return chicken to the pot. Add brandy if using, and carefully light it. Once flames subside, pour in the reserved marinade. Bring to a simmer, then reduce heat, cover, and cook for 1.5 to 2 hours until chicken is very tender."], nutritionalInfo: { calories: "600 kcal", protein: "50g", carbs: "15g", fat: "30g" } },
    { recipeName: "Hummus Platter with Pita Bread", baseServings: 6, imageUrl: "https://i0.wp.com/greenevi.com/wp-content/uploads/2020/05/greenevi-hummus-pita01.jpg?resize=800%2C972&ssl=1", description: "A simple and social dish perfect for sharing.", cuisine: "Mediterranean", difficulty: "Easy", cookingTime: "10", dietaryTags: ["Vegetarian"], ingredients: ["1 can (15 oz) chickpeas, rinsed", "0.25 cup tahini", "1 lemon, juiced", "1 clove garlic", "Pita bread for serving", "Cucumbers and carrots for dipping"], instructions: ["In a food processor, combine the tahini and lemon juice. Process for 1 minute.", "Add the chickpeas, garlic, and a pinch of salt. Process until the hummus is thick and smooth. Add 2-3 tablespoons of water if needed to reach desired consistency.", "Taste and adjust seasoning. Serve in a bowl, drizzled with olive oil and a sprinkle of paprika. Serve with warm pita and fresh vegetables."], nutritionalInfo: { calories: "250 kcal", protein: "8g", carbs: "30g", fat: "12g" } },
    { recipeName: "One-Pan Sausage and Veggies", baseServings: 4, imageUrl: "https://www.onceuponachef.com/images/2020/09/Sheet-Pan-Sausage-and-Vegetables-1200x1496.jpg", description: "An incredibly easy and delicious weeknight dinner.", cuisine: "American", difficulty: "Easy", cookingTime: "35", dietaryTags: ["Gluten-Free"], ingredients: ["1 lb Italian sausage, cut into 1-inch pieces", "1 lb broccoli florets", "1 red bell pepper, chopped", "1 red onion, cut into wedges", "2 tbsp olive oil"], instructions: ["Preheat oven to 400°F (200°C).", "On a large sheet pan, combine the sausage, broccoli, bell pepper, and red onion.", "Drizzle with olive oil and toss to coat. Season with salt, pepper, and Italian seasoning if desired.", "Spread everything in an even layer on the pan.", "Roast for 25-30 minutes, tossing halfway through, until the vegetables are tender and the sausage is cooked through and browned."], nutritionalInfo: { calories: "480 kcal", protein: "22g", carbs: "15g", fat: "35g" } }
];

const AnimatedView = ({ children }) => <div className="animate-fade-in">{children}</div>;

// --- Ingredient Quantity Adjustment Logic ---
function adjustIngredient(ingredient, baseServings, currentServings) {
    if (!baseServings || baseServings === 0) return ingredient;
    if (baseServings === currentServings) return ingredient;
    const ratio = currentServings / baseServings;
    const regex = /^(\d+\s*\d\/\d|\d+\/\d|\d+\.\d+|\d+)/;
    const match = ingredient.match(regex);

    if (!match) return ingredient;

    const quantityStr = match[0];
    let quantityNum;

    // Convert string quantity (e.g., "1 1/2", "1/2") to a number
    if (quantityStr.includes('/')) {
        const parts = quantityStr.split(' ');
        if (parts.length > 1) { // Mixed number e.g. "1 1/2"
            const fracParts = parts[1].split('/');
            quantityNum = parseInt(parts[0]) + parseInt(fracParts[0]) / parseInt(fracParts[1]);
        } else { // Fraction e.g. "1/2"
            const fracParts = parts[0].split('/');
            quantityNum = parseInt(fracParts[0]) / parseInt(fracParts[1]);
        }
    } else {
        quantityNum = parseFloat(quantityStr);
    }

    let newQuantity = quantityNum * ratio;
    
    // Basic formatting for new quantity (can be improved with a fraction library)
    let newQuantityStr;
    if (newQuantity < 1 && newQuantity > 0) {
        if (Math.abs(newQuantity - 0.5) < 0.01) newQuantityStr = "1/2";
        else if (Math.abs(newQuantity - 0.25) < 0.01) newQuantityStr = "1/4";
        else if (Math.abs(newQuantity - 0.75) < 0.01) newQuantityStr = "3/4";
        else if (Math.abs(newQuantity - 0.33) < 0.01) newQuantityStr = "1/3";
        else if (Math.abs(newQuantity - 0.66) < 0.01) newQuantityStr = "2/3";
        else newQuantityStr = newQuantity.toFixed(2);
    } else {
         newQuantityStr = Number.isInteger(newQuantity) ? newQuantity.toString() : newQuantity.toFixed(1).replace('.0', '');
    }
   
    return ingredient.replace(regex, newQuantityStr);
}


// --- Main App Component ---
function App() {
    const { useState, useEffect, useCallback, useRef } = React;
    const [view, setView] = useState('home');
    const [selectedRecipe, setSelectedRecipe] = useState(null);
    const [generatedRecipes, setGeneratedRecipes] = useState([]);
    const [savedRecipes, setSavedRecipes] = useState([]);
    const [suggestedRecipes, setSuggestedRecipes] = useState([]);
    const [currentServings, setCurrentServings] = useState(4);
    const [assistantMessages, setAssistantMessages] = useState([]);
    const [assistantLoading, setAssistantLoading] = useState(false);
    const [suggestedModification, setSuggestedModification] = useState(null);
    const [ingredients, setIngredients] = useState('');
    const [image, setImage] = useState(null);
    const [imagePreview, setImagePreview] = useState('');
    const [dietaryPrefs, setDietaryPrefs] = useState([]);
    const [difficulty, setDifficulty] = useState('Any');
    const [cookingTime, setCookingTime] = useState('');
    const [isLoading, setIsLoading] = useState(false);
    const [error, setError] = useState(null);
    const [loadingMessage, setLoadingMessage] = useState('Generating recipes...');
    const [notification, setNotification] = useState(null);
    const [auth, setAuth] = useState(null);
    const [db, setDb] = useState(null);
    const [userId, setUserId] = useState(null);
    const [isAuthReady, setIsAuthReady] = useState(false);
    const fileInputRef = useRef(null);

    const showNotification = (message, type = 'info') => {
        setNotification({ message, type });
        setTimeout(() => {
            setNotification(null);
        }, 3000);
    };

    const callApiWithBackoff = async (url, payload, retries = 3, delay = 1000) => {
        try {
            const response = await fetch(url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
            if (!response.ok) {
                 throw new Error(`API Error: ${response.statusText}`);
            }
            return await response.json();
        } catch (e) {
            if (retries > 0) {
                await new Promise(res => setTimeout(res, delay));
                return callApiWithBackoff(url, payload, retries - 1, delay * 2);
            }
            throw e;
        }
    };
    
    const generateSuggestions = useCallback(async (userRecipes) => {
        const ratedRecipes = userRecipes.filter(r => r.rating > 0);
        if (ratedRecipes.length === 0) {
            setSuggestedRecipes([]);
            return;
        }

        const preferences = ratedRecipes.map(r => `${r.recipeName} (rated ${r.rating})`).join('; ');
        const prompt = `Based on a user's rated recipes (${preferences}), suggest 3 new, exciting recipe ideas they might love from this list: ${predefinedRecipes.map(p=>p.recipeName).join(', ')}.`;
        const payload = {
            contents: [{ parts: [{ text: prompt }] }],
            generationConfig: {
                responseMimeType: "application/json",
                responseSchema: {
                    type: "ARRAY", items: { type: "OBJECT", properties: { recipeName: { type: "STRING" }, description: { type: "STRING" } } }
                }
            }
        };
        try {
            const result = await callApiWithBackoff(GEMINI_API_URL_TEXT, payload);
            const suggestions = JSON.parse(result.candidates[0].content.parts[0].text);
            setSuggestedRecipes(suggestions);
        } catch(err) { console.error("Suggestion generation failed:", err); }
    }, []);
    
    // --- Firebase & App Initialization ---
    useEffect(() => {
        try {
            if (!firebase.apps.length) {
                const app = firebase.initializeApp(firebaseConfig);
                setAuth(app.auth());
                setDb(app.firestore());
            } else {
                const app = firebase.app();
                setAuth(app.auth());
                setDb(app.firestore());
            }
        } catch (e) { console.error("Firebase initialization error:", e); setError("Application failed to initialize."); }
    }, []);

    useEffect(() => {
        if (!auth) return;
        const unsubscribe = auth.onAuthStateChanged(user => {
            if (user) {
                setUserId(user.uid);
            } else {
                auth.signInAnonymously().catch(err => console.error("Anonymous sign-in failed:", err));
            }
            setIsAuthReady(true);
        });
        return () => unsubscribe();
    }, [auth]);

    useEffect(() => {
        if (!isAuthReady || !db || !userId) return;
        const savedRecipesCol = db.collection(`artifacts/${appId}/users/${userId}/saved_recipes`);
        const unsubscribe = savedRecipesCol.onSnapshot(snapshot => {
            const userRecipes = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            setSavedRecipes(userRecipes);
            generateSuggestions(userRecipes); // Let generateSuggestions handle the logic
        }, err => console.error("Error fetching saved recipes:", err));
        return () => unsubscribe();
    }, [isAuthReady, db, userId, generateSuggestions]);
    
    const getIngredientsFromImage = async (base64Image) => {
        setLoadingMessage('Analyzing your ingredients...');
        const payload = { contents: [{ parts: [{ text: "Accurately identify all food ingredients in this image. Respond with ONLY a comma-separated list." }, { inlineData: { mimeType: "image/jpeg", data: base64Image } }] }] };
        const result = await callApiWithBackoff(GEMINI_API_URL_TEXT, payload);
        return result.candidates[0].content.parts[0].text;
    };
    
    const findRecipesLocally = (ingredientList) => {
        setLoadingMessage('Searching for recipes...');
        const userIngredients = ingredientList.toLowerCase().split(',').map(i => i.trim()).filter(Boolean);

        const matchedRecipes = predefinedRecipes.map(recipe => {
            const matchCount = userIngredients.filter(userIng => 
                recipe.ingredients.some(recipeIng => recipeIng.toLowerCase().includes(userIng))
            ).length;
            return { ...recipe, matchCount };
        }).filter(recipe => recipe.matchCount > 0);

        const filteredRecipes = matchedRecipes.filter(recipe => {
            const passesDietary = dietaryPrefs.every(pref => recipe.dietaryTags.includes(pref));
            const passesDifficulty = difficulty === 'Any' || recipe.difficulty === difficulty;
            const timeNum = parseInt(cookingTime);
            const passesTime = !cookingTime || isNaN(timeNum) || parseInt(recipe.cookingTime) <= timeNum;
            return passesDietary && passesDifficulty && passesTime;
        });

        filteredRecipes.sort((a, b) => b.matchCount - a.matchCount);
        return filteredRecipes.slice(0, 6);
    };
    
    const getCookingAssistantResponse = async (recipe, messageHistory, newUserMessage) => {
        setAssistantLoading(true);
        setSuggestedModification(null);
        const systemPrompt = `You are Chef AI, a helpful cooking assistant for "${recipe.recipeName}". 
        1. Answer user questions concisely about this recipe.
        2. If the user asks for an ingredient substitution, analyze if it's a valid culinary change.
        3. If it is, respond with a confirmation message, followed by a special JSON block containing the ENTIRE MODIFIED recipe. This JSON block MUST start with \`_MODIFICATION_START_\` and end with \`_MODIFICATION_END_\`.
        4. The JSON must be a single object, not an array, matching the recipe structure.
        5. Update the recipeName, ingredients, and instructions to reflect the change. Recalculate nutritional info if possible.
        Example response for a substitution: "Yes, you can use tofu. Here is the updated recipe. _MODIFICATION_START_{\\"recipeName\\":\\"Spicy Thai Green Curry (with Tofu)\\", \\"ingredients\\":[...], \\"instructions\\":[...], ...}_MODIFICATION_END_"
        The original recipe instructions are: ${recipe.instructions.join('. ')}`;
        
        const contents = [ ...messageHistory.map(msg => ({ role: msg.role === 'user' ? 'user' : 'model', parts: [{ text: msg.text }] })), { role: 'user', parts: [{ text: newUserMessage }] }];
        const payload = { contents, systemInstruction: { parts: [{ text: systemPrompt }] } };
        
        try {
            const result = await callApiWithBackoff(GEMINI_API_URL_TEXT, payload);
            return result.candidates[0].content.parts[0].text;
        } catch (err) {
            console.error("Cooking assistant API call failed:", err);
            return "I'm sorry, I'm having trouble right now. Please try again.";
        } finally {
            setAssistantLoading(false);
        }
    };

    const handleGenerateClick = async () => {
        if (!ingredients && !image) { setError("Please add ingredients or upload a photo."); return; }
        setIsLoading(true); setError(null); setGeneratedRecipes([]);
        try {
            let finalIngredients = ingredients;
            if (image) {
                const base64Image = imagePreview.split(',')[1];
                const imageIngredients = await getIngredientsFromImage(base64Image);
                finalIngredients = [ingredients, imageIngredients].filter(Boolean).join(', ');
                setIngredients(finalIngredients);
            }
            if (!finalIngredients.trim()) throw new Error("Could not identify any ingredients.");

            let recipes = findRecipesLocally(finalIngredients);
             // Merge with user ratings before displaying
            recipes = recipes.map(recipe => {
                const savedVersion = savedRecipes.find(saved => saved.recipeName === recipe.recipeName);
                return savedVersion ? { ...recipe, rating: savedVersion.rating } : recipe;
            });

            if (recipes.length === 0) {
                setError("No recipes found matching your ingredients and filters. Try changing your criteria.");
            }
            setGeneratedRecipes(recipes);
            setView('results');

        } catch (err) {
            setError(`An error occurred: ${err.message}.`);
        } finally {
            setIsLoading(false);
        }
    };

    const handleRecipeClick = (recipe) => {
        let fullRecipe = predefinedRecipes.find(r => r.recipeName === recipe.recipeName) || recipe;
        setAssistantMessages([]);
        setSuggestedModification(null);
        setSelectedRecipe(fullRecipe);
        setCurrentServings(fullRecipe.baseServings); // Set initial serving size
        setView('recipe');
    };

    const handleAskAssistant = async (newUserMessage) => {
        if (!newUserMessage.trim() || !selectedRecipe) return;
        const updatedMessages = [...assistantMessages, { role: 'user', text: newUserMessage }];
        setAssistantMessages(updatedMessages);
        const responseText = await getCookingAssistantResponse(selectedRecipe, updatedMessages, newUserMessage);

        const modStart = responseText.indexOf('_MODIFICATION_START_');
        const modEnd = responseText.indexOf('_MODIFICATION_END_');

        if (modStart !== -1 && modEnd !== -1) {
            const jsonString = responseText.substring(modStart + '_MODIFICATION_START_'.length, modEnd);
            const conversationalPart = responseText.substring(0, modStart).trim();
            try {
                const modification = JSON.parse(jsonString);
                setSuggestedModification(modification);
                setAssistantMessages(prev => [...prev, { role: 'assistant', text: conversationalPart, modification: true }]);
            } catch (e) {
                console.error("Failed to parse recipe modification JSON:", e);
                setAssistantMessages(prev => [...prev, { role: 'assistant', text: conversationalPart }]);
            }
        } else {
            setAssistantMessages(prev => [...prev, { role: 'assistant', text: responseText }]);
        }
    };

    const handleApplyModification = () => {
        if (!suggestedModification) return;
        setSelectedRecipe(suggestedModification);
        setSuggestedModification(null);
        setCurrentServings(suggestedModification.baseServings);
        setAssistantMessages(prev => [...prev, { role: 'system', text: 'Recipe has been updated!' }]);
    };
    
    const handleSaveRecipe = async (recipe) => {
        if (!isAuthReady || !db || !userId) return;
        const recipeId = recipe.recipeName.replace(/\s+/g, '-').toLowerCase();
        const recipeRef = db.collection(`artifacts/${appId}/users/${userId}/saved_recipes`).doc(recipeId);
        await recipeRef.set({ ...recipe, rating: 0 });
        showNotification("Recipe saved!", "success");
    };

    const handleRateRecipe = async (recipeId, rating) => {
        if (!isAuthReady || !db || !userId) return;
        const recipeRef = db.collection(`artifacts/${appId}/users/${userId}/saved_recipes`).doc(recipeId);
        await recipeRef.update({ rating });
        showNotification("Thank you for your rating!", "success");
    };

    const handleDeleteRecipe = async (recipeId) => {
        if (!isAuthReady || !db || !userId) return;
        const recipeRef = db.collection(`artifacts/${appId}/users/${userId}/saved_recipes`).doc(recipeId);
        await recipeRef.delete();
        showNotification("Recipe removed.", "info");
    };
    
    const handleImageChange = (e) => {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onloadend = () => { setImage(file); setImagePreview(reader.result); };
            reader.readAsDataURL(file);
        }
    };

    const handleToggleDietaryPref = (pref) => {
        setDietaryPrefs(prev => prev.includes(pref) ? prev.filter(p => p !== pref) : [...prev, pref]);
    };

    const renderContent = () => {
        if (!isAuthReady) return <LoadingSpinner message="Connecting to services..." />;
        if (isLoading) return <LoadingSpinner message={loadingMessage} />;

        switch (view) {
            case 'results': return <AnimatedView><RecipeList recipes={generatedRecipes} onRecipeClick={handleRecipeClick} onBack={() => setView('home')} /></AnimatedView>;
            case 'recipe': return <AnimatedView><RecipeDetail recipe={selectedRecipe} savedRecipes={savedRecipes} onBack={() => setView(generatedRecipes.length > 0 ? 'results' : 'saved')} onSave={handleSaveRecipe} onDelete={handleDeleteRecipe} onRate={handleRateRecipe} isSaved={savedRecipes.some(r => r.id === selectedRecipe?.recipeName.replace(/\s+/g, '-').toLowerCase())} assistantMessages={assistantMessages} onAskAssistant={handleAskAssistant} assistantLoading={assistantLoading} suggestedModification={suggestedModification} onApplyModification={handleApplyModification} currentServings={currentServings} setCurrentServings={setCurrentServings} showNotification={showNotification} /></AnimatedView>;
            case 'saved': return <AnimatedView><SavedRecipes recipes={savedRecipes} onRecipeClick={handleRecipeClick} onBack={() => setView('home')} /></AnimatedView>;
            default: return <AnimatedView><HomePage onGenerateClick={handleGenerateClick} ingredients={ingredients} setIngredients={setIngredients} imagePreview={imagePreview} handleImageChange={handleImageChange} fileInputRef={fileInputRef} setImagePreview={setImagePreview} setImage={setImage} dietaryPrefs={dietaryPrefs} setDietaryPrefs={setDietaryPrefs} handleToggleDietaryPref={handleToggleDietaryPref} difficulty={difficulty} setDifficulty={setDifficulty} cookingTime={cookingTime} setCookingTime={setCookingTime} suggestedRecipes={suggestedRecipes} onRecipeClick={handleRecipeClick} savedRecipes={savedRecipes} /></AnimatedView>;
        }
    };

    return (
        <div className="bg-gray-900 font-sans min-h-screen text-gray-200">
            <Header setView={setView} />
            <main className="max-w-7xl mx-auto p-4 md:p-8">
                {error && <ErrorMessage message={error} clearError={() => setError(null)} />}
                {renderContent()}
            </main>
            {notification && <Notification message={notification.message} type={notification.type} />}
            <Footer />
        </div>
    );
}

// --- Components ---
const Header = ({ setView }) => {
    const { useState, useEffect } = React;
    return (
        <header className="bg-gray-900/80 backdrop-blur-sm shadow-lg shadow-green-500/10 sticky top-0 z-20">
            <nav className="max-w-7xl mx-auto p-4 flex justify-between items-center">
                 <div className="flex items-center space-x-3 cursor-pointer" onClick={() => setView('home')}>
                    <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-green-400"><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2Z"/><path d="M16.2 7.8 12 12l-4.2 4.2"/><path d="m12 12 4.2-4.2L12 12Z"/></svg>
                    <h1 className="text-xl font-bold text-white">Chef AI</h1>
                </div>
                <button onClick={() => setView('saved')} className="flex items-center space-x-2 px-4 py-2 text-sm font-semibold text-gray-300 hover:bg-gray-700 rounded-lg transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>
                    <span>My Recipes</span>
                </button>
            </nav>
        </header>
    );
};

const HomePage = ({ onGenerateClick, suggestedRecipes, onRecipeClick, savedRecipes, ...props }) => {
    const hasRatedRecipe = savedRecipes.some(r => r.rating > 0);
    return (
        <div className="space-y-16">
            <IngredientInput handleGenerateClick={onGenerateClick} {...props} />
            {savedRecipes.length > 0 && !hasRatedRecipe && (
                <div className="text-center bg-gray-800 p-4 rounded-lg border border-green-500/20">
                    <p className="text-green-400 font-semibold">Rate a saved recipe to unlock personalized suggestions!</p>
                </div>
            )}
            {suggestedRecipes.length > 0 && <SuggestionsSection recipes={suggestedRecipes} onRecipeClick={onRecipeClick} />}
            <InspirationSection onRecipeClick={onRecipeClick} />
        </div>
    );
};

const IngredientInput = ({ handleGenerateClick, ingredients, setIngredients, imagePreview, handleImageChange, fileInputRef, setImagePreview, setImage, dietaryPrefs, setDietaryPrefs, handleToggleDietaryPref, difficulty, setDifficulty, cookingTime, setCookingTime }) => {
    const removeImage = () => { setImage(null); setImagePreview(''); if (fileInputRef.current) fileInputRef.current.value = ""; };
    const clearFilters = () => { setDietaryPrefs([]); setDifficulty('Any'); setCookingTime(''); };
    const dietaryOptions = ['Vegetarian', 'Vegan', 'Gluten-Free', 'Dairy-Free'];
    const difficultyOptions = ['Any', 'Easy', 'Medium', 'Hard'];
    const hasActiveFilters = dietaryPrefs.length > 0 || difficulty !== 'Any' || cookingTime !== '';
    
    return (
    <div className="bg-gray-800 p-6 md:p-8 rounded-2xl shadow-2xl shadow-green-500/10 border border-gray-700">
        <div className="text-center mb-8">
            <h2 className="text-4xl font-bold text-white">What's in your kitchen?</h2>
            <p className="text-gray-400 mt-2">Let's turn your ingredients into a masterpiece.</p>
        </div>
         <div className="grid grid-cols-1 md:grid-cols-2 gap-8 items-start">
            <div className="space-y-4">
                <h3 className="text-xl font-semibold text-white mb-2 text-center md:text-left">1. Add Your Ingredients</h3>
                <div className="w-full h-64 border-2 border-dashed border-gray-600 rounded-xl flex items-center justify-center text-gray-400 bg-gray-900 hover:bg-gray-700/50 transition-colors relative group">
                    {imagePreview ? <img src={imagePreview} alt="Ingredients preview" className="w-full h-full object-contain rounded-xl p-2" /> : <div className="text-center">Upload a photo</div>}
                    {imagePreview && <button onClick={removeImage} className="absolute top-2 right-2 bg-red-600 text-white rounded-full p-1.5 opacity-0 group-hover:opacity-100 transition-opacity">&times;</button>}
                    <input ref={fileInputRef} type="file" accept="image/*" onChange={handleImageChange} className="absolute inset-0 w-full h-full opacity-0 cursor-pointer" />
                </div>
                <p className="text-gray-500 text-sm text-center">Or</p>
                <textarea value={ingredients} onChange={(e) => setIngredients(e.target.value)} placeholder="e.g., chicken breast, broccoli, soy sauce..." className="w-full p-4 bg-gray-900 border border-gray-700 rounded-xl focus:ring-2 focus:ring-green-400 focus:border-green-400 transition h-40 resize-none" />
            </div>
            <div className="space-y-6">
                <h3 className="text-xl font-semibold text-white mb-2 text-center md:text-left">2. Refine Your Search</h3>
                <div>
                    <h4 className="text-lg font-semibold text-gray-300 mb-2">Dietary Preferences</h4>
                    <div className="flex flex-wrap gap-2">{dietaryOptions.map(opt => <button key={opt} onClick={() => handleToggleDietaryPref(opt)} className={`px-4 py-2 rounded-full text-sm font-semibold transition-colors ${dietaryPrefs.includes(opt) ? 'bg-green-500 text-white' : 'bg-gray-700 text-gray-300 hover:bg-gray-600'}`}>{opt}</button>)}</div>
                </div>
                 <div>
                    <h4 className="text-lg font-semibold text-gray-300 mb-2">Max Cooking Time (minutes)</h4>
                    <input type="number" value={cookingTime} onChange={(e) => setCookingTime(e.target.value)} placeholder="e.g., 30" className="w-full p-3 bg-gray-900 border border-gray-700 rounded-xl focus:ring-2 focus:ring-green-400" />
                </div>
                 <div>
                    <h4 className="text-lg font-semibold text-gray-300 mb-2">Difficulty</h4>
                    <div className="flex flex-wrap gap-2">{difficultyOptions.map(opt => <button key={opt} onClick={() => setDifficulty(opt)} className={`px-4 py-2 rounded-full text-sm font-semibold transition-colors ${difficulty === opt ? 'bg-green-500 text-white' : 'bg-gray-700 text-gray-300 hover:bg-gray-600'}`}>{opt}</button>)}</div>
                </div>
            </div>
        </div>
        <div className="mt-8 text-center space-y-4">
             {hasActiveFilters && <div className="text-sm text-gray-400 flex justify-center items-center gap-4">
                <div className="flex flex-wrap gap-x-2 gap-y-1 justify-center">
                    {dietaryPrefs.map(p => <span key={p} className="bg-gray-700 px-2 py-1 rounded-md">{p}</span>)}
                    {difficulty !== 'Any' && <span className="bg-gray-700 px-2 py-1 rounded-md">{difficulty}</span>}
                    {cookingTime && <span className="bg-gray-700 px-2 py-1 rounded-md">&lt; {cookingTime} min</span>}
                </div>
                <button onClick={clearFilters} className="font-semibold text-red-400 hover:underline">Clear</button>
            </div>}
            <button onClick={handleGenerateClick} className="w-full md:w-auto bg-green-500 text-white font-bold py-4 px-10 rounded-xl text-lg hover:bg-green-600 transition-transform transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-green-300 shadow-lg shadow-green-500/20">
                Generate Recipes
            </button>
        </div>
    </div>
)};

const InspirationSection = ({ onRecipeClick }) => (
    <div>
        <h2 className="text-3xl font-bold text-center mb-8">Get Inspired</h2>
        <div className="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-4">
            {predefinedRecipes.map(recipe => (
                <div key={recipe.recipeName} onClick={() => onRecipeClick(recipe)} className="bg-gray-800 p-4 rounded-lg cursor-pointer text-center hover:bg-gray-700 transition-all transform hover:scale-105">
                    <p className="font-bold text-white truncate">{recipe.recipeName}</p>
                    <p className="text-sm text-gray-400">{recipe.cuisine}</p>
                </div>
            ))}
        </div>
    </div>
);

const SuggestionsSection = ({ recipes, onRecipeClick }) => (
    <div>
        <h2 className="text-3xl font-bold text-center mb-8">Chef's Suggestions For You</h2>
        <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
            {recipes.map(recipe => (
                 <div key={recipe.recipeName} onClick={() => onRecipeClick(recipe)} className="bg-gray-800 p-5 rounded-xl shadow-lg border border-gray-700 hover:border-green-400 cursor-pointer transition-all transform hover:-translate-y-1">
                    <h3 className="font-bold text-lg text-green-400">{recipe.recipeName}</h3>
                    <p className="text-sm text-gray-400 mt-1">{recipe.description}</p>
                </div>
            ))}
        </div>
    </div>
);

const RecipeList = ({ recipes, onRecipeClick, onBack }) => (
    <div>
        <div className="flex justify-between items-center mb-6">
            <h2 className="text-3xl font-bold text-white">Matching Recipes</h2>
            <button onClick={onBack} className="text-green-400 font-semibold hover:underline">&larr; Back to Ingredients</button>
        </div>
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            {recipes.map((recipe) => (
                <RecipeCard key={recipe.recipeName} recipe={recipe} onClick={() => onRecipeClick(recipe)} />
            ))}
        </div>
    </div>
);

const RecipeCard = ({ recipe, onClick }) => {
    let borderColor = 'border-gray-700 hover:border-green-400';
    let badge = null;

    if (recipe.rating > 0) {
        if (recipe.rating >= 3) {
            borderColor = 'border-green-500';
            badge = <div className="absolute top-2 right-2 bg-green-500 text-white text-xs font-bold px-3 py-1 rounded-full">Favorite</div>;
        } else {
            borderColor = 'border-red-500';
            badge = <div className="absolute top-2 right-2 bg-red-500 text-white text-xs font-bold px-3 py-1 rounded-full">Tried</div>;
        }
    }

    return (
        <div onClick={onClick} className={`bg-gray-800 rounded-2xl shadow-lg overflow-hidden cursor-pointer hover:shadow-green-500/20 transition-all duration-300 group transform hover:-translate-y-2 border-2 ${borderColor}`}>
            <div className="h-56 bg-gray-700 flex items-center justify-center relative">
                <img src={recipe.imageUrl} alt={recipe.recipeName} className="w-full h-full object-cover transition-transform duration-300 group-hover:scale-110" />
                 <div className="absolute top-2 left-2 bg-gray-900/50 backdrop-blur-sm text-white text-xs font-bold px-3 py-1 rounded-full flex items-center gap-1">
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                    {recipe.cookingTime} min
                 </div>
                 {badge}
            </div>
            <div className="p-5">
                 {recipe.rating > 0 && (
                    <div className="flex items-center mb-1">
                        {[1,2,3,4,5].map(star => <svg key={star} className={`w-4 h-4 ${recipe.rating >= star ? 'text-yellow-400' : 'text-gray-600'}`} fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" /></svg>)}
                    </div>
                )}
                <h3 className="text-xl font-bold text-white truncate group-hover:text-green-400 transition-colors">{recipe.recipeName}</h3>
                <div className="mt-2 text-xs text-gray-400 grid grid-cols-2 gap-1">
                    <span>🔥 {recipe.nutritionalInfo?.calories}</span>
                    <span>💪 P: {recipe.nutritionalInfo?.protein}</span>
                    <span>🍞 C: {recipe.nutritionalInfo?.carbs}</span>
                    <span>🥑 F: {recipe.nutritionalInfo?.fat}</span>
                </div>
            </div>
        </div>
    );
};

const RecipeDetail = ({ recipe, onBack, onSave, onDelete, onRate, isSaved, savedRecipes, assistantMessages, onAskAssistant, assistantLoading, suggestedModification, onApplyModification, currentServings, setCurrentServings, showNotification }) => {
    if (!recipe) return null;
    const recipeId = recipe.recipeName.replace(/\s+/g, '-').toLowerCase();
    
    const savedVersion = savedRecipes.find(r => r.id === recipeId);
    const displayRating = savedVersion ? savedVersion.rating : 0;

    // Calculate adjusted ingredients
    const adjustedIngredients = recipe.ingredients.map(ing => adjustIngredient(ing, recipe.baseServings, currentServings));

    const handleServingChange = (amount) => {
        const newServings = currentServings + amount;
        if (newServings > 0) {
            setCurrentServings(newServings);
        }
    };

    return (
        <div className="bg-gray-800 p-6 md:p-8 rounded-2xl shadow-2xl shadow-green-500/10 border border-gray-700 space-y-8">
            <div className="md:flex md:space-x-8">
                <div className="md:w-1/3 mb-6 md:mb-0"><div className="h-64 w-full bg-gray-700 rounded-lg shadow-lg"><img src={recipe.imageUrl} alt={recipe.recipeName} className="w-full h-full object-cover rounded-lg" /></div></div>
                <div className="md:w-2/3"><button onClick={onBack} className="text-green-400 font-semibold hover:underline mb-2">&larr; Back</button><h2 className="text-4xl font-extrabold text-white">{recipe.recipeName}</h2><p className="text-gray-400 mt-2">{recipe.description}</p><div className="mt-4 flex items-center justify-between"><StarRating rating={displayRating} onRate={(rating) => onRate(recipeId, rating)} isSaved={isSaved} showNotification={showNotification} /><button onClick={() => isSaved ? onDelete(recipeId) : onSave(recipe)} className={`px-4 py-2 rounded-lg font-semibold ${isSaved ? 'bg-red-500/20 text-red-400' : 'bg-green-500/20 text-green-400'}`}>{isSaved ? 'Saved' : 'Save Recipe'}</button></div></div>
            </div>
            <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div className="lg:col-span-1">
                    <div className="flex justify-between items-center mb-4">
                         <h3 className="text-2xl font-bold border-b-2 border-green-500 pb-2 text-white">Ingredients</h3>
                         <div className="flex items-center gap-2">
                            <span className="text-gray-400 text-sm">Servings:</span>
                            <button onClick={() => handleServingChange(-1)} className="bg-gray-700 w-8 h-8 rounded-full font-bold text-lg">-</button>
                            <span className="font-bold text-lg w-8 text-center">{currentServings}</span>
                            <button onClick={() => handleServingChange(1)} className="bg-gray-700 w-8 h-8 rounded-full font-bold text-lg">+</button>
                         </div>
                    </div>
                    <ul className="space-y-2 text-gray-300 list-disc list-inside">{adjustedIngredients.map((item, index) => <li key={index}>{item}</li>)}</ul>
                </div>
                <div className="lg:col-span-2">
                    <h3 className="text-2xl font-bold border-b-2 border-green-500 pb-2 mb-4 text-white">Instructions</h3>
                    <ol className="space-y-4 text-gray-300">{recipe.instructions.map((step, index) => (<li key={index} className="flex items-start"><span className="mr-3 flex-shrink-0 bg-green-500 text-white rounded-full h-8 w-8 flex items-center justify-center font-bold">{index + 1}</span><p className="leading-relaxed">{step}</p></li>))}</ol>
                    <p className="text-sm text-gray-500 mt-4 italic">Note: Cooking times may vary slightly with adjusted serving sizes.</p>
                </div>
            </div>
            <CookingAssistant messages={assistantMessages} onAsk={onAskAssistant} isLoading={assistantLoading} suggestedModification={suggestedModification} onApplyModification={onApplyModification} />
        </div>
    );
};


const CookingAssistant = ({ messages, onAsk, isLoading, suggestedModification, onApplyModification }) => {
    const { useState, useEffect, useRef } = React;
    const [input, setInput] = useState('');
    const messagesEndRef = useRef(null);
    useEffect(() => { messagesEndRef.current?.scrollIntoView({ behavior: "smooth" }); }, [messages]);

    const handleSubmit = (e) => { e.preventDefault(); onAsk(input); setInput(''); };

    return (
        <div className="pt-8 border-t border-gray-700">
            <h3 className="text-2xl font-bold text-white mb-4">Cooking Assistant</h3>
            <div className="bg-gray-900 rounded-lg p-4 h-64 overflow-y-auto flex flex-col space-y-4">
                {messages.map((msg, index) => (
                    <div key={index} className={`flex items-end gap-2 ${msg.role === 'user' ? 'justify-end' : ''} ${msg.role === 'system' ? 'justify-center' : ''}`}>
                         {msg.role === 'system' ? (<div className="text-center text-sm text-green-400 font-semibold bg-green-500/10 px-4 py-1 rounded-full">{msg.text}</div>) : (<div className={`max-w-xs lg:max-w-md px-4 py-2 rounded-xl ${msg.role === 'user' ? 'bg-green-500 text-white' : 'bg-gray-700 text-gray-200'}`}>{msg.text}</div>) }
                         {msg.modification && suggestedModification && (<button onClick={onApplyModification} className="ml-2 bg-blue-500 text-white px-3 py-1 rounded-lg text-sm hover:bg-blue-600">Apply Change</button>)}
                    </div>
                ))}
                {isLoading && <div className="flex justify-start"><div className="px-4 py-2 rounded-xl bg-gray-700 text-gray-200 animate-pulse">Thinking...</div></div>}
                <div ref={messagesEndRef} />
            </div>
            <form onSubmit={handleSubmit} className="mt-4 flex gap-2">
                <input type="text" value={input} onChange={(e) => setInput(e.target.value)} placeholder="Ask for substitutions, techniques..." className="flex-grow p-3 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-green-400 focus:border-green-400" />
                <button type="submit" className="bg-green-500 text-white font-bold py-3 px-6 rounded-lg hover:bg-green-600 transition-colors" disabled={isLoading}>Send</button>
            </form>
        </div>
    );
};

const StarRating = ({ rating, onRate, isSaved, showNotification }) => (
    <div className="flex space-x-1">
        {[1, 2, 3, 4, 5].map(star => 
            <svg 
                key={star} 
                onClick={() => isSaved ? onRate(star) : showNotification("Please save the recipe to give a rating.")} 
                className={`w-6 h-6 ${rating >= star ? 'text-yellow-400' : 'text-gray-600'} cursor-pointer hover:text-yellow-300`} 
                fill="currentColor" 
                viewBox="0 0 20 20"
            >
                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
            </svg>
        )}
    </div>
);

const SavedRecipes = ({ recipes, onRecipeClick, onBack }) => (
     <div>
        <div className="flex justify-between items-center mb-6"><h2 className="text-3xl font-bold text-white">Your Saved Recipes</h2><button onClick={onBack} className="text-green-400 font-semibold hover:underline">&larr; Home</button></div>
        {recipes.length > 0 ? (<div className="space-y-4">{recipes.map((recipe) => (<div key={recipe.id} onClick={() => onRecipeClick(recipe)} className="bg-gray-800 p-4 rounded-xl shadow-sm flex justify-between items-center cursor-pointer hover:bg-gray-700 transition-colors"><div><h3 className="font-bold text-lg text-white">{recipe.recipeName}</h3><p className="text-sm text-gray-400">{recipe.description}</p></div><StarRating rating={recipe.rating || 0} isSaved={true} onRate={()=>{}} /></div>))}</div>) : <div className="text-center py-16 bg-gray-800 rounded-xl shadow"><p className="text-gray-400">You haven't saved any recipes yet.</p></div>}
    </div>
);

const LoadingSpinner = ({ message }) => (
    <div className="flex flex-col items-center justify-center text-center py-20"><div className="animate-spin rounded-full h-16 w-16 border-b-4 border-green-400 mb-4"></div><p className="text-lg font-semibold text-gray-300">{message}</p></div>
);

const Notification = ({ message, type }) => {
    const bgColor = type === 'success' ? 'bg-green-500' : 'bg-blue-500';
    return (
        <div className={`fixed bottom-5 left-1/2 -translate-x-1/2 px-6 py-3 rounded-lg text-white shadow-lg animate-fade-in-up ${bgColor}`}>
            {message}
        </div>
    );
};

const ErrorMessage = ({ message, clearError }) => (
    <div className="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded-lg mb-6 flex justify-between items-center"><span>{message}</span><button onClick={clearError} className="font-bold text-xl">&times;</button></div>
);

const Footer = () => (
    <footer className="max-w-7xl mx-auto text-center py-6 text-gray-500 text-sm"><p>Powered by AI. Recipes are suggestions and should be prepared with care.</p><p>&copy; 2025 Chef AI. Technical Assessment Project.</p></footer>
);
    </script>
    
    <script type="text/babel">
        // Mount the main App component to the 'root' div
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

